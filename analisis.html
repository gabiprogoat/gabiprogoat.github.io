<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Análisis de datos (CSV público)</title>
<style>
body{margin:0;font-family:system-ui,sans-serif;background:#f1f3f6;}
header{background:#111827;color:white;padding:14px;text-align:center;}
.container{padding:14px;display:grid;gap:14px;}
.card{background:white;border-radius:14px;padding:14px;box-shadow:0 4px 14px rgba(0,0,0,.08);}
select,input,button{padding:6px 8px;border-radius:6px;border:1px solid #ccc;}
button{background:#2563eb;color:white;border:none;cursor:pointer;}
button:hover{background:#1d4ed8;}
.result{font-size:.9rem;border-bottom:1px solid #eee;padding:6px 0;}
.back{color:#2563eb;text-decoration:none;font-weight:600;}
</style>
</head>
<body>
<header>Análisis de datos (CSV público)</header>

<div class="container">

<div class="card">
  <a href="index.html" class="back">← Volver</a>
</div>

<div class="card">
  <h3>Añadir CSV público (primera hoja)</h3>
  <input id="csvUrl" placeholder="URL CSV público">
  <button onclick="addDoc()">Añadir</button>
</div>

<div class="card">
  <h3>Selección A</h3>
  <select id="docA" onchange="loadColumns('A')"></select>
  <select id="colA"></select>
</div>

<div class="card">
  <h3>Selección B</h3>
  <select id="docB" onchange="loadColumns('B')"></select>
  <select id="colB"></select>
</div>

<div class="card">
  <button onclick="analyze()">Analizar</button>
</div>

<div class="card">
  <h3>Resultado</h3>
  <div id="results"></div>
</div>

</div>

<script>
// === STORAGE ===
const docs = JSON.parse(localStorage.getItem("csv_docs") || "[]");
const save=()=>localStorage.setItem("csv_docs",JSON.stringify(docs));

// === HELPERS ===
function parseCSV(text){
  let delimiter = text.includes("\t") ? "\t" : ",";
  const lines = text.split(/\r?\n/).filter(l=>l.trim()!=="");
  const headers = lines[0].split(delimiter).map(h=>h.trim());
  const rows = lines.slice(1).map(line=>line.split(delimiter));
  return {headers, rows};
}

function parseNumber(v){
  if(!v) return NaN;
  v=v.toString().replace(/[^\d.,-]/g,"");
  if(v.includes(",") && v.includes(".")){
    v=v.lastIndexOf(",")>v.lastIndexOf(".")?v.replace(/\./g,"").replace(",","."):v.replace(/,/g,"");
  } else if(v.includes(",")) v=v.replace(",",".");
  return parseFloat(v);
}

// === LOAD DOC ===
function addDoc(){
  const url=document.getElementById("csvUrl").value.trim();
  if(!url) return alert("Ingresá un link CSV público");
  fetch(url)
    .then(r=>r.text())
    .then(text=>{
      const {headers, rows} = parseCSV(text);
      docs.push({url, headers, rows});
      save();
      updateDocs();
      document.getElementById("csvUrl").value="";
    })
    .catch(()=>alert("No se pudo cargar el CSV. Revisá que sea público."));
}

function updateDocs(){
  ["A","B"].forEach(t=>{
    const s=document.getElementById("doc"+t);
    s.innerHTML="";
    docs.forEach((d,i)=>s.add(new Option(`CSV ${i+1}`,i)));
    loadColumns(t);
  });
}

function loadColumns(t){
  const d = docs[document.getElementById("doc"+t).value];
  const c = document.getElementById("col"+t);
  c.innerHTML="";
  d.headers.forEach((h,i)=>c.add(new Option(h,i)));
}

// === ANALYZE ===
function analyze(){
  const a = docs[docA.value], b = docs[docB.value];
  const max = Math.max(a.rows.length, b.rows.length);
  const out = document.getElementById("results");
  out.innerHTML="";

  for(let i=0;i<max;i++){
    const vA=a.rows[i]?.[colA.value]||"";
    const vB=b.rows[i]?.[colB.value]||"";

    const nA=parseNumber(vA), nB=parseNumber(vB);
    const isNumA=!isNaN(nA), isNumB=!isNaN(nB);

    let res;
    if(isNumA && isNumB) res = nA>nB?`A es mayor (${nA} > ${nB})`:nB>nA?`B es mayor (${nB} > ${nA})`:"Iguales";
    else if(isNumA) res = "A es numérico y B no";
    else if(isNumB) res = "B es numérico y A no";
    else res = vA.length>vB.length?"A tiene más letras":vB.length>vA.length?"B tiene más letras":"Iguales";

    out.innerHTML+=`<div class="result">Fila ${i+2}: ${res}</div>`;
  }
}

// Inicializar selects
updateDocs();
</script>
</body>
</html>
